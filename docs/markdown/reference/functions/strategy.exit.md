### strategy.exit()

Creates price-based orders to exit from an open position. If unfilled exit orders with the same `id` exist, calls to this command modify those orders. This command can generate more than one type of exit order, depending on the specified parameters. However, it does not create [market orders](https://www.tradingview.com/pine-script-docs/concepts/strategies/#market-orders). To exit from a position with a market order, use [strategy.close](#fun_strategy.close) or [strategy.close\_all](#fun_strategy.close_all).

If a call to this command contains a `profit` or `limit` argument, it creates [take-profit](https://www.tradingview.com/pine-script-docs/concepts/strategies/#take-profit-and-stop-loss) orders to exit from applicable trades at the determined price levels or better values (higher for long trades and lower for short ones). If the call contains `loss` or `stop` arguments, it creates [stop-loss](https://www.tradingview.com/pine-script-docs/concepts/strategies/#take-profit-and-stop-loss) orders to exit from applicable trades at the determined levels or worse values (lower for long trades and higher for short ones). Calling this command with `profit` or `limit` and `loss` or `stop` arguments creates an order bracket with both order types.

This command can create [trailing stop](https://www.tradingview.com/pine-script-docs/concepts/strategies/#trailing-stops) orders when its call specifies a `trail_price` or `trail_points` argument and a `trail_offset` argument. A trailing stop order activates when the price moves `trail_points` ticks past the entry price or touches the `trail_price` level. Once activated, the stop follows `trail_offset` ticks behind the market price each time the trade's profit reaches a new high. The stop does not move when the trade does not achieve a new best value.

Each call to this command reserves a portion of the position to close until the strategy fills or cancels its orders. For example, if there is an open position of 50 contracts and a [strategy.exit](#fun_strategy.exit) call specifies a `qty` of 20, that call's orders reserve 20 contracts out of the position. A second call can close a maximum of 30 contracts, even if its `qty` is 50 and one of its orders executes first. This behavior does not affect the orders from other commands, such as [strategy.close](#fun_strategy.close) or [strategy.order](#fun_strategy.order).

If a call to this command occurs before a created entry order's execution, the strategy waits and does not create the exit orders until after the entry order executes.

Syntax

```
strategy.exit(id, from_entry, qty, qty_percent, profit, limit, loss, stop, trail_price, trail_points, trail_offset, oca_name, comment, comment_profit, comment_loss, comment_trailing, alert_message, alert_profit, alert_loss, alert_trailing, disable_alert) â†’ void
```

Arguments

id (series string) The identifier of the orders, which corresponds to an exit ID in the strategy's trades after an order fills. Strategy commands can reference the order ID to cancel or modify pending exit orders. The Strategy Tester and the chart display the order ID unless the command includes a `comment*` argument that applies to the filled order.

from\_entry (series string) Optional. The entry order ID of the trade to exit from. If there is more than one open trade with the specified entry ID, the command generates exit orders for all the entries from before or at the time of the call. The default is an empty string, which means the command generates exit orders for all open trades until the position closes.

qty (series int/float) Optional. The number of contracts/lots/shares/units to close when an exit order fills. If specified, the command uses this value instead of `qty_percent` to determine the order size. The exit orders reserve this quantity from the position, meaning other calls to this command cannot close this portion until the strategy fills or cancels those orders. The default is [na](#var_na), which means the order size depends on the `qty_percent` value.

qty\_percent (series int/float) Optional. A value between 0 and 100 representing the percentage of the open trade quantity to close when an exit order fills. The exit orders reserve this percentage from the applicable open trades, meaning other calls to this command cannot close this portion until the strategy fills or cancels those orders. The percentage calculation depends on the total size of the applicable open trades without considering the reserved amount from other [strategy.exit](#fun_strategy.exit) calls. The command ignores this parameter if the `qty` value is not [na](#var_na). The default is 100.

profit (series int/float) Optional. The take-profit distance, expressed in ticks. If specified, the command creates a limit order to exit the trade `profit` ticks away from the entry price in the favorable direction. The order executes at the calculated price or a better value. If this parameter and `limit` are not [na](#var_na), the command places a take-profit order only at the price level expected to trigger an exit first. The default is [na](#var_na).

limit (series int/float) Optional. The take-profit price. If this parameter and `profit` are not [na](#var_na), the command places a take-profit order only at the price level expected to trigger an exit first. The default is [na](#var_na).

loss (series int/float) Optional. The stop-loss distance, expressed in ticks. If specified, the command creates a stop order to exit the trade `loss` ticks away from the entry price in the unfavorable direction. The order executes at the calculated price or a worse value. If this parameter and `stop` are not [na](#var_na), the command places a stop-loss order only at the price level expected to trigger an exit first. The default is [na](#var_na).

stop (series int/float) Optional. The stop-loss price. If this parameter and `loss` are not [na](#var_na), the command places a stop-loss order only at the price level expected to trigger an exit first. The default is [na](#var_na).

trail\_price (series int/float) Optional. The price of the trailing stop activation level. If the value is more favorable than the entry price, the command creates a trailing stop when the market price reaches that value. If less favorable than the entry price, the command creates the trailing stop immediately when the current market price is equal to or more favorable than the value. If this parameter and `trail_points` are not [na](#var_na), the command sets the activation level using the value expected to activate the stop first. The default is [na](#var_na).

trail\_points (series int/float) Optional. The trailing stop activation distance, expressed in ticks. If the value is positive, the command creates a trailing stop order when the market price moves `trail_points` ticks away from the trade's entry price in the favorable direction. If the value is negative, the command creates the trailing stop immediately when the market price is equal to or more favorable than the level `trail_points` ticks away from the entry price in the unfavorable direction. The default is [na](#var_na).

trail\_offset (series int/float) Optional. The trailing stop offset. When the market price reaches the activation level determined by the `trail_price` or `trail_points` parameter, or exceeds the level in the favorable direction, the command creates a trailing stop with an initial value `trail_offset` ticks away from that level in the unfavorable direction. After activation, the trailing stop moves toward the market price each time the trade's profit reaches a better value, maintaining the specified distance behind the best price. The default is [na](#var_na).

oca\_name (series string) Optional. The name of the One-Cancels-All (OCA) group that the command's take-profit, stop-loss, and trailing stop orders belong to. All orders from this command are of the [strategy.oca.reduce](#const_strategy.oca.reduce) OCA type. When an order of this OCA type with the same `oca_name` executes, the strategy reduces the sizes of other unfilled orders in the OCA group by the filled quantity. The default is an empty string, which means the strategy assigns the OCA name automatically, and the resulting orders cannot reduce or be reduced by the orders from other commands.

comment (series string) Optional. Additional notes on the filled order. If the value is not an empty string, the Strategy Tester and the chart show this text for the order instead of the specified `id`. The command ignores this value if the call includes an argument for a `comment_*` parameter that applies to the order. The default is an empty string.

comment\_profit (series string) Optional. Additional notes on the filled order. If the value is not an empty string, the Strategy Tester and the chart show this text for the order instead of the specified `id` or `comment`. This comment applies only to the command's take-profit orders created using the `profit` or `limit` parameter. The default is an empty string.

comment\_loss (series string) Optional. Additional notes on the filled order. If the value is not an empty string, the Strategy Tester and the chart show this text for the order instead of the specified `id` or `comment`. This comment applies only to the command's stop-loss orders created using the `loss` or `stop` parameter. The default is an empty string.

comment\_trailing (series string) Optional. Additional notes on the filled order. If the value is not an empty string, the Strategy Tester and the chart show this text for the order instead of the specified `id` or `comment`. This comment applies only to the command's trailing stop orders created using the `trail_price` or `trail_points` and `trail_offset` parameters. The default is an empty string.

alert\_message (series string) Optional. Custom text for the alert that fires when an order fills. If the "Message" field of the "Create Alert" dialog box contains the `{{strategy.order.alert_message}}` placeholder, the alert message replaces the placeholder with this text. The command ignores this value if the call includes an argument for the other `alert_*` parameter that applies to the order. The default is an empty string.

alert\_profit (series string) Optional. Custom text for the alert that fires when an order fills. If the "Message" field of the "Create Alert" dialog box contains the `{{strategy.order.alert_message}}` placeholder, the alert message replaces the placeholder with this text. This message applies only to the command's take-profit orders created using the `profit` or `limit` parameter. The default is an empty string.

alert\_loss (series string) Optional. Custom text for the alert that fires when an order fills. If the "Message" field of the "Create Alert" dialog box contains the `{{strategy.order.alert_message}}` placeholder, the alert message replaces the placeholder with this text. This message applies only to the command's stop-loss orders created using the `loss` or `stop` parameter. The default is an empty string.

alert\_trailing (series string) Optional. Custom text for the alert that fires when an order fills. If the "Message" field of the "Create Alert" dialog box contains the `{{strategy.order.alert_message}}` placeholder, the alert message replaces the placeholder with this text. This message applies only to the command's trailing stop orders created using the `trail_price` or `trail_points` and `trail_offset` parameters. The default is an empty string.

disable\_alert (series bool) Optional. If [true](#const_true) when the command creates an order, the strategy does not trigger an alert when that order fills. This parameter accepts a "series" value, meaning users can control which orders trigger alerts when they execute. The default is [false](#const_false).

Example

```
//@version=6  
strategy("ExitÂ bracketÂ strategy",Â overlayÂ =Â true)  
  
//Â InputsÂ thatÂ defineÂ theÂ profitÂ andÂ lossÂ amountÂ ofÂ eachÂ tradeÂ asÂ aÂ tickÂ distanceÂ fromÂ theÂ entryÂ price.  
intÂ profitDistanceInputÂ =Â input.int(100,Â "ProfitÂ distance,Â inÂ ticks",Â 1)  
intÂ lossDistanceInputÂ Â Â =Â input.int(100,Â "LossÂ distance,Â inÂ ticks",Â 1)  
  
//Â VariablesÂ toÂ trackÂ theÂ take-profitÂ andÂ stop-lossÂ price.  
varÂ floatÂ takeProfitÂ =Â na  
varÂ floatÂ stopLossÂ Â Â =Â na  
  
//Â CalculateÂ aÂ 14-barÂ andÂ 28-barÂ movingÂ averageÂ ofÂ `close`Â prices.  
floatÂ sma14Â =Â ta.sma(close,Â 14)  
floatÂ sma28Â =Â ta.sma(close,Â 28)  
  
ifÂ ta.crossover(sma14,Â sma28)Â andÂ strategy.opentradesÂ ==Â 0  
Â Â Â Â //Â PlaceÂ aÂ marketÂ orderÂ toÂ enterÂ aÂ longÂ position.  
Â Â Â Â strategy.entry("MyÂ LongÂ EntryÂ ID",Â strategy.long)  
Â Â Â Â //Â PlaceÂ aÂ take-profitÂ andÂ stop-lossÂ orderÂ whenÂ theÂ entryÂ orderÂ fills.  
Â Â Â Â strategy.exit("MyÂ LongÂ ExitÂ ID",Â "MyÂ LongÂ EntryÂ ID",Â profitÂ =Â profitDistanceInput,Â lossÂ =Â lossDistanceInput)  
  
ifÂ ta.change(strategy.opentrades)Â ==Â 1  
Â Â Â Â //@variableÂ TheÂ longÂ entryÂ price.  
Â Â Â Â floatÂ entryPriceÂ =Â strategy.opentrades.entry_price(0)  
Â Â Â Â //Â UpdateÂ theÂ `takeProfit`Â andÂ `stopLoss`Â values.  
Â Â Â Â takeProfitÂ :=Â entryPriceÂ +Â profitDistanceInputÂ *Â syminfo.mintick  
Â Â Â Â stopLossÂ Â Â :=Â entryPriceÂ -Â lossDistanceInputÂ *Â syminfo.mintick  
  
ifÂ ta.change(strategy.closedtrades)Â ==Â 1  
Â Â Â Â //Â ResetÂ theÂ `takeProfit`Â andÂ `stopLoss`.  
Â Â Â Â takeProfitÂ :=Â na  
Â Â Â Â stopLossÂ Â Â :=Â na  
  
//Â PlotÂ theÂ `takeProfit`Â andÂ `stopLoss`.  
plot(takeProfit,Â "Take-profitÂ level",Â color.green,Â 2,Â plot.style_linebr)  
plot(stopLoss,Â "Stop-lossÂ level",Â color.red,Â 2,Â plot.style_linebr)
```

Example

```
//@version=6  
strategy("TrailingÂ stopÂ strategy",Â overlayÂ =Â true)  
  
//@variableÂ TheÂ distanceÂ requiredÂ toÂ activateÂ theÂ trailingÂ stop.  
floatÂ activationDistanceInputÂ =Â input.int(100,Â "TrailÂ activationÂ distance,Â inÂ ticks")Â *Â syminfo.mintick  
//@variableÂ TheÂ numberÂ ofÂ ticksÂ theÂ trailingÂ stopÂ followsÂ behindÂ theÂ priceÂ asÂ itÂ reachesÂ newÂ peaks.  
intÂ trailDistanceInputÂ =Â input.int(100,Â "TrailÂ distance,Â inÂ ticks")  
  
//@functionÂ DrawsÂ aÂ labelÂ andÂ lineÂ atÂ theÂ specifiedÂ `price`Â toÂ visualizeÂ aÂ trailingÂ stopÂ order'sÂ activationÂ level.  
drawActivation(floatÂ price)Â =>  
Â Â Â Â label.new(  
Â Â Â Â Â Â Â Â Â bar_index,Â price,Â "ActivationÂ level",Â styleÂ =Â label.style_label_right,  
Â Â Â Â Â Â Â Â Â colorÂ =Â color.gray,Â textcolorÂ =Â color.white  
Â Â Â Â Â )  
Â Â Â Â line.new(  
Â Â Â Â Â Â Â Â Â bar_index,Â price,Â bar_indexÂ +Â 1,Â price,Â extendÂ =Â extend.right,Â styleÂ =Â line.style_dashed,Â colorÂ =Â color.gray  
Â Â Â Â Â )  
  
//@functionÂ StopsÂ theÂ `l`Â lineÂ fromÂ extendingÂ further.  
methodÂ stopExtend(lineÂ l)Â =>  
Â Â Â Â l.set_x2(bar_index)  
Â Â Â Â l.set_extend(extend.none)  
  
//Â TheÂ activationÂ line,Â activeÂ trailingÂ stopÂ price,Â andÂ activeÂ trailingÂ stopÂ flag.  
varÂ lineÂ activationLineÂ Â Â Â Â =Â na  
varÂ floatÂ trailingStopPriceÂ =Â na  
varÂ boolÂ isActiveÂ Â Â Â Â Â Â Â Â Â Â =Â false  
  
ifÂ bar_indexÂ %Â 100Â ==Â 0Â andÂ strategy.opentradesÂ ==Â 0  
Â Â Â Â trailingStopPriceÂ :=Â na  
Â Â Â Â isActiveÂ Â Â Â Â Â Â Â Â Â :=Â false  
Â Â Â Â //Â PlaceÂ aÂ marketÂ orderÂ toÂ enterÂ aÂ longÂ position.  
Â Â Â Â strategy.entry("MyÂ LongÂ EntryÂ ID",Â strategy.long)  
Â Â Â Â //@variableÂ TheÂ activationÂ level'sÂ price.  
Â Â Â Â floatÂ activationPriceÂ =Â closeÂ +Â activationDistanceInput  
Â Â Â Â //Â CreateÂ aÂ trailingÂ stopÂ orderÂ thatÂ activatesÂ theÂ definedÂ numberÂ ofÂ ticksÂ aboveÂ theÂ entryÂ price.  
Â Â Â Â strategy.exit(  
Â Â Â Â Â Â Â Â Â "MyÂ LongÂ ExitÂ ID",Â "MyÂ LongÂ EntryÂ ID",Â trail_priceÂ =Â activationPrice,Â trail_offsetÂ =Â trailDistanceInput,  
Â Â Â Â Â Â Â Â Â oca_nameÂ =Â "Exit"  
Â Â Â Â Â )  
Â Â Â Â //Â CreateÂ newÂ drawingsÂ atÂ theÂ `activationPrice`.  
Â Â Â Â activationLineÂ :=Â drawActivation(activationPrice)  
  
//Â LogicÂ forÂ trailingÂ stopÂ visualization.  
ifÂ strategy.opentradesÂ ==Â 1  
Â Â Â Â //Â StopÂ extendingÂ theÂ `activationLine`Â whenÂ theÂ stopÂ activates.  
Â Â Â Â ifÂ notÂ isActiveÂ andÂ highÂ >Â activationLine.get_price(bar_index)  
Â Â Â Â Â Â Â Â isActiveÂ :=Â true  
Â Â Â Â Â Â Â Â activationLine.stopExtend()  
Â Â Â Â //Â UpdateÂ theÂ `trailingStopPrice`Â whileÂ theÂ trailingÂ stopÂ isÂ active.  
Â Â Â Â ifÂ isActive  
Â Â Â Â Â Â Â Â floatÂ offsetPriceÂ =Â highÂ -Â trailDistanceInputÂ *Â syminfo.mintick  
Â Â Â Â Â Â Â Â trailingStopPriceÂ :=Â math.max(nz(trailingStopPrice,Â offsetPrice),Â offsetPrice)  
  
//Â CloseÂ theÂ tradeÂ withÂ aÂ marketÂ orderÂ ifÂ theÂ trailingÂ stopÂ doesÂ notÂ activateÂ beforeÂ theÂ nextÂ 300thÂ bar.  
ifÂ notÂ isActiveÂ andÂ bar_indexÂ %Â 300Â ==Â 0  
Â Â Â Â strategy.close_all("MarketÂ close")  
  
//Â ResetÂ theÂ `trailingStopPrice`Â andÂ `isActive`Â flagsÂ whenÂ theÂ tradeÂ closes,Â andÂ stopÂ extendingÂ theÂ `activationLine`.  
ifÂ ta.change(strategy.closedtrades)Â >Â 0  
Â Â Â Â ifÂ notÂ isActive  
Â Â Â Â Â Â Â Â activationLine.stopExtend()  
Â Â Â Â trailingStopPriceÂ :=Â na  
Â Â Â Â isActiveÂ Â Â Â Â Â Â Â Â Â :=Â false  
  
//Â PlotÂ theÂ `trailingStopPrice`.  
plot(trailingStopPrice,Â "TrailingÂ stop",Â color.red,Â 3,Â plot.style_linebr)
```

Remarks

A single call to the [strategy.exit](#fun_strategy.exit) command can generate exit orders for several entries in an open position, depending on the call's `from_entry` value. If the call does not include a `from_entry` argument, it creates exit orders for all open trades, even the ones opened after the call, until the position closes. See [this](https://www.tradingview.com/pine-script-docs/concepts/strategies/#exits-for-multiple-entries) section of our User Manual to learn more.

When a position consists of several open trades, and the `close_entries_rule` in the [strategy](#fun_strategy) declaration statement is "FIFO" (default), the orders from a [strategy.exit](#fun_strategy.exit) call exit from the position starting with the first open trade. This behavior applies even if the `from_entry` value is the entry ID of different open trades. However, in that case, the maximum size of the exit orders still depends on the trades opened by orders with the `from_entry` ID. For more information, see [this](https://www.tradingview.com/pine-script-docs/concepts/strategies/#closing-a-market-position) section of our User Manual.

If a [strategy.exit](#fun_strategy.exit) call includes arguments for creating stop-loss and trailing stop orders, the command places only the order that is supposed to fill first, because both orders are of the "stop" type.
